<!doctype html>

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>EPL Picks Manager</title>

```
<!-- React (no build step) -->
<script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
<script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

<!-- Babel (JSX in this file) -->
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<style>
  :root { --bg:#0b1220; --card:#101a33; --text:#e7eefc; --muted:#9fb0d0; --line:#233458; --accent:#1b3bff; }
  body { margin:0; font-family:-apple-system,system-ui,Segoe UI,Roboto,Arial; background:var(--bg); color:var(--text); }
  a { color: inherit; text-decoration: none; }
  .wrap { max-width: 1200px; margin: 0 auto; padding: 18px; }
  h1 { margin: 0 0 10px; font-size: 20px; }
  .row { display:flex; gap:12px; flex-wrap:wrap; align-items:flex-start; }
  .card { background:var(--card); border:1px solid var(--line); border-radius:14px; padding:12px; }
  .card h2 { margin:0 0 10px; font-size: 14px; color: var(--muted); font-weight: 600; letter-spacing: .2px; }
  input, select, button, textarea {
    background:#0d1730; color:var(--text); border:1px solid var(--line);
    border-radius:10px; padding:10px; font-size: 14px;
  }
  button { cursor:pointer; }
  button.primary { background:var(--accent); border-color:var(--accent); }
  button.danger { background:#a31616; border-color:#a31616; }
  .muted { color: var(--muted); font-size: 12px; }
  .grid { overflow:auto; max-width: 100%; border-radius: 12px; border:1px solid var(--line); }
  table { border-collapse: collapse; width: max-content; min-width: 100%; }
  th, td { border:1px solid var(--line); padding: 8px; white-space: nowrap; }
  th { position: sticky; top:0; background:#0d1730; z-index:2; }
  td.sticky, th.sticky { position: sticky; left:0; background:#0d1730; z-index:3; font-weight:700; }
  td.sticky { z-index:1; font-weight:600; }
  .badge { display:inline-block; padding:4px 8px; border-radius:999px; border:1px solid var(--line); color:var(--muted); font-size:12px; }
  .pill { display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
  .heat0 { background:#c6efce; color:#111; }
  .heat1 { background:#ffeb9c; color:#111; }
  .heat2 { background:#f4cccc; color:#111; }
  .small { font-size: 12px; }
  .twoCol { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
  @media (max-width: 900px){ .twoCol{ grid-template-columns: 1fr; } }
  .tabs { display:flex; gap:8px; flex-wrap:wrap; margin: 10px 0 14px; }
  .tab {
    padding:10px 12px; border-radius: 999px; border:1px solid var(--line);
    background:#0d1730; color:var(--muted); font-weight:600; font-size: 13px;
  }
  .tab.active { background: var(--accent); border-color: var(--accent); color: white; }
  .kbd { font-family: ui-monospace, SFMono-Regular, Menlo, monospace; font-size: 12px; padding: 2px 6px; border:1px solid var(--line); border-radius: 6px; }
  .ok { color:#7CFFB2; }
  .warn { color:#FFD07C; }
  .bad { color:#FF8C8C; }
  .right { text-align:right; }
  .loading { text-align: center; padding: 40px; }
  .spinner { border: 3px solid var(--line); border-top: 3px solid var(--accent); border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 0 auto; }
  @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  .readonly-banner { background: #2a4a7c; padding: 8px 12px; border-radius: 10px; margin-bottom: 12px; text-align: center; font-size: 13px; }
  pre { background: #0d1730; padding: 10px; border-radius: 8px; overflow-x: auto; font-size: 11px; }
</style>
```

  </head>

  <body>
    <div id="root"></div>

```
<script type="text/babel">
  const { useEffect, useMemo, useState } = React;

  // Your Google Sheets ID - UPDATE THIS WITH YOUR ACTUAL SPREADSHEET ID
  const SHEET_ID = "1x9gMQl64X4WcR4yoLznln3CWUoqbtddg4xM7rUWBCwY";

  function normaliseTeamName(name){
    return (name ?? "").toString().trim();
  }

  function toInt(val){
    const n = parseInt((val ?? "").toString(), 10);
    return Number.isFinite(n) ? n : 0;
  }

  function useHashRoute(){
    const getRoute = () => (window.location.hash || "#/picks").replace("#", "");
    const [route, setRoute] = useState(getRoute());
    useEffect(() => {
      const onHash = () => setRoute(getRoute());
      window.addEventListener("hashchange", onHash);
      return () => window.removeEventListener("hashchange", onHash);
    }, []);
    return [route, (r) => window.location.hash = "#" + r];
  }

  function Tab({label, route, current, setRoute}){
    const active = current === route;
    return (
      <a className={"tab" + (active ? " active" : "")} href={"#" + route} onClick={(e)=>{e.preventDefault(); setRoute(route);}}>
        {label}
      </a>
    );
  }

  async function fetchSheetData(){
    try {
      // Use the public HTML export which works with "anyone with link" sharing
      const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=xlsx`;
      
      console.log("Fetching from:", url);
      const response = await fetch(url, {
        mode: 'cors',
        credentials: 'omit'
      });
      
      if(!response.ok) {
        throw new Error(`HTTP ${response.status}: Sheet may not be shared correctly. Make sure "Anyone with the link" can view.`);
      }

      const arrayBuffer = await response.arrayBuffer();
      
      // Check if we actually got XLSX data
      const uint8 = new Uint8Array(arrayBuffer);
      const header = String.fromCharCode.apply(null, uint8.slice(0, 4));
      if(header !== 'PK\u0003\u0004') {
        throw new Error("Received invalid data - not an Excel file. Check sharing settings.");
      }

      // Load with SheetJS
      const workbook = XLSX.read(uint8, { type: 'array' });
      
      console.log("Available sheets:", workbook.SheetNames);

      // Parse PICKS sheet
      if(!workbook.Sheets["PICKS"]) {
        throw new Error("No 'PICKS' sheet found in workbook");
      }

      const picksSheet = workbook.Sheets["PICKS"];
      const picksData = XLSX.utils.sheet_to_json(picksSheet, { header: 1, defval: "" });
      
      console.log("PICKS data rows:", picksData.length);

      if(picksData.length < 2) {
        throw new Error("PICKS sheet is empty");
      }

      const picksHeader = picksData[0];
      const compIdx = picksHeader.findIndex(h => 
        String(h).toLowerCase().includes('competitor')
      );
      
      if(compIdx === -1) {
        throw new Error(`No 'Competitor' column found. Found: ${picksHeader.join(', ')}`);
      }

      const maxGWs = 38;
      const gwCols = {};
      for(let gw=1; gw<=maxGWs; gw++){
        const idx = picksHeader.findIndex(h => String(h) === `GW${gw}`);
        if(idx !== -1) gwCols[gw] = idx;
      }

      const competitors = [];
      const picks = {};
      
      for(let r=1; r<picksData.length; r++){
        const row = picksData[r];
        const c = normaliseTeamName(row[compIdx]);
        if(!c) continue;
        competitors.push(c);
        picks[c] = {};
        for(let gw=1; gw<=maxGWs; gw++){
          const idx = gwCols[gw];
          if(idx === undefined) continue;
          const t = normaliseTeamName(row[idx]);
          if(t) picks[c][gw] = t;
        }
      }

      console.log("Loaded competitors:", competitors);

      // Parse POINTS sheet
      let points = {};
      if(workbook.Sheets["POINTS"]){
        const pointsSheet = workbook.Sheets["POINTS"];
        const pointsData = XLSX.utils.sheet_to_json(pointsSheet, { header: 1, defval: "" });
        
        if(pointsData.length > 1){
          const ptsHeader = pointsData[0];
          const compIdx2 = ptsHeader.findIndex(h => 
            String(h).toLowerCase().includes('competitor')
          );
          
          const gwCols2 = {};
          for(let gw=1; gw<=maxGWs; gw++){
            const idx = ptsHeader.findIndex(h => String(h) === `GW${gw}`);
            if(idx !== -1) gwCols2[gw] = idx;
          }
          
          for(let r=1; r<pointsData.length; r++){
            const row = pointsData[r];
            const c = normaliseTeamName(row[compIdx2]);
            if(!c) continue;
            points[c] = {};
            for(let gw=1; gw<=maxGWs; gw++){
              const idx = gwCols2[gw];
              if(idx === undefined) continue;
              const v = toInt(row[idx]);
              if(v) points[c][gw] = v;
            }
          }
        }
      }

      // Parse TEAMS sheet
      let teams = [];
      if(workbook.Sheets["TEAMS"]){
        const teamsSheet = workbook.Sheets["TEAMS"];
        const teamsData = XLSX.utils.sheet_to_json(teamsSheet, { header: 1, defval: "" });
        
        for(let r=1; r<teamsData.length; r++){
          const v = normaliseTeamName(teamsData[r]?.[0]);
          if(v) teams.push(v);
        }
      }

      // If no teams, derive from picks
      if(!teams.length){
        const s = new Set();
        for(const c of competitors){
          Object.values(picks[c] || {}).forEach(t => {
            const normalized = normaliseTeamName(t);
            if(normalized) s.add(normalized);
          });
        }
        teams = Array.from(s).sort((a,b)=>a.localeCompare(b));
      }

      console.log("Loaded teams:", teams.length);

      return { competitors, teams, picks, points, maxGWs };
      
    } catch(err){
      console.error("Error fetching sheet:", err);
      throw err;
    }
  }

  function App(){
    const [state, setState] = useState(null);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState(null);
    const [route, setRoute] = useHashRoute();
    const [lastUpdate, setLastUpdate] = useState(null);

    useEffect(() => {
      loadData();
    }, []);

    async function loadData(){
      setLoading(true);
      setError(null);
      try {
        const data = await fetchSheetData();
        setState(data);
        setLastUpdate(new Date().toLocaleTimeString());
      } catch(err){
        setError(err.message);
      } finally {
        setLoading(false);
      }
    }

    if(loading){
      return (
        <div className="wrap">
          <h1>EPL Picks Manager</h1>
          <div className="card loading">
            <div className="spinner"></div>
            <p style={{marginTop: 20}}>Loading data from Google Sheets...</p>
          </div>
        </div>
      );
    }

    if(error){
      return (
        <div className="wrap">
          <h1>EPL Picks Manager</h1>
          <div className="card">
            <h2>Error Loading Data</h2>
            <p className="bad">{error}</p>
            <div className="muted" style={{marginTop: 12}}>
              <p><strong>Required setup:</strong></p>
              <ol>
                <li>Open your Google Sheet</li>
                <li>Click the <strong>Share</strong> button (top right)</li>
                <li>Under "General access", select <strong>"Anyone with the link"</strong></li>
                <li>Make sure access is set to <strong>"Viewer"</strong></li>
                <li>Click <strong>Done</strong></li>
              </ol>
              <p><strong>Sheet structure required:</strong></p>
              <ul>
                <li>Must have a sheet tab named <strong>PICKS</strong></li>
                <li>First row: <code>Competitor | GW1 | GW2 | GW3 | ...</code></li>
                <li>Optional: <strong>POINTS</strong> sheet (same structure)</li>
                <li>Optional: <strong>TEAMS</strong> sheet with team names</li>
              </ul>
              <p style={{marginTop: 12}}>
                <button className="primary" onClick={loadData}>Retry</button>
              </p>
            </div>
          </div>
        </div>
      );
    }

    const { competitors, teams, picks, points, maxGWs } = state;

    const usageByCompetitorAndTeam = useMemo(() => {
      const usage = {};
      for (const c of competitors) usage[c] = {};
      for (const c of competitors) for (const t of teams) usage[c][t] = 0;

      for (const c of competitors) {
        const row = picks?.[c] || {};
        for (let gw=1; gw<=maxGWs; gw++){
          const t = normaliseTeamName(row[gw]);
          if(t && usage[c]?.[t] !== undefined) usage[c][t] += 1;
        }
      }
      return usage;
    }, [picks, competitors, teams, maxGWs]);

    const totalTeamUsage = useMemo(() => {
      const totals = {};
      for (const t of teams) totals[t] = 0;
      for (const c of competitors){
        for (const t of teams){
          totals[t] += (usageByCompetitorAndTeam[c]?.[t] || 0);
        }
      }
      return totals;
    }, [usageByCompetitorAndTeam, competitors, teams]);

    const leastUsedTeam = useMemo(() => {
      let bestTeam = null;
      let bestVal = Infinity;
      for (const t of teams){
        const v = totalTeamUsage[t] ?? 0;
        if (v < bestVal) { bestVal = v; bestTeam = t; }
      }
      return bestTeam ? { team: bestTeam, picks: bestVal } : null;
    }, [totalTeamUsage, teams]);

    const totalsByCompetitor = useMemo(() => {
      const totals = {};
      for (const c of competitors){
        let sum = 0;
        const row = points?.[c] || {};
        for(let gw=1; gw<=maxGWs; gw++){
          sum += toInt(row[gw]);
        }
        totals[c] = sum;
      }
      return totals;
    }, [points, competitors, maxGWs]);

    const leaderboard = useMemo(() => {
      return [...competitors]
        .map(c => ({ competitor: c, totalPoints: totalsByCompetitor[c] || 0 }))
        .sort((a,b) => b.totalPoints - a.totalPoints || a.competitor.localeCompare(b.competitor));
    }, [competitors, totalsByCompetitor]);

    function heatClass(val){
      if(val <= 0) return "heat0";
      if(val === 1) return "heat1";
      return "heat2";
    }

    function TopBar(){
      return (
        <>
          <h1>EPL Picks Manager</h1>
          
          <div className="readonly-banner">
            ðŸ”’ Read-Only Mode â€¢ Data from Google Sheets â€¢ Last updated: {lastUpdate} â€¢ <a href="#" onClick={(e)=>{e.preventDefault(); loadData();}} style={{textDecoration:"underline"}}>Refresh</a>
          </div>

          <div className="pill" style={{marginBottom: 10}}>
            {leastUsedTeam && (
              <span className="badge">
                Least used team: <b>{leastUsedTeam.team}</b> ({leastUsedTeam.picks} picks)
              </span>
            )}
            <span className="badge">Rule: max <b>2</b> picks per team per competitor</span>
          </div>

          <div className="tabs">
            <Tab label="Picks" route="/picks" current={route} setRoute={setRoute} />
            <Tab label="Points" route="/points" current={route} setRoute={setRoute} />
            <Tab label="Leaderboard" route="/leaderboard" current={route} setRoute={setRoute} />
            <Tab label="Usage Heatmap" route="/usage" current={route} setRoute={setRoute} />
          </div>
        </>
      );
    }

    function PicksPage(){
      return (
        <div className="card">
          <h2>Picks (by Gameweek)</h2>

          <div className="grid">
            <table>
              <thead>
                <tr>
                  <th className="sticky">Competitor</th>
                  {Array.from({length:maxGWs}, (_,i)=>i+1).map(gw => (
                    <th key={gw}>GW{gw}</th>
                  ))}
                </tr>
              </thead>
              <tbody>
                {competitors.map(c => (
                  <tr key={c}>
                    <td className="sticky">{c}</td>
                    {Array.from({length:maxGWs}, (_,i)=>i+1).map(gw => {
                      const team = picks?.[c]?.[gw] || "â€”";
                      return <td key={gw}>{team}</td>;
                    })}
                  </tr>
                ))}
              </tbody>
            </table>
          </div>

          <div className="muted" style={{marginTop:10}}>
            Tip: On iPhone, rotate to landscape for easier scrolling.
          </div>
        </div>
      );
    }

    function PointsPage(){
      return (
        <div className="card">
          <h2>Points (by Gameweek)</h2>

          <div className="grid">
            <table>
              <thead>
                <tr>
                  <th className="sticky">Competitor</th>
                  {Array.from({length:maxGWs}, (_,i)=>i+1).map(gw => (
                    <th key={gw}>GW{gw}</th>
                  ))}
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                {competitors.map(c => (
                  <tr key={c}>
                    <td className="sticky">{c}</td>
                    {Array.from({length:maxGWs}, (_,i)=>i+1).map(gw => {
                      const pts = points?.[c]?.[gw] || "";
                      return <td key={gw} className="right">{pts}</td>;
                    })}
                    <td className="right"><b>{totalsByCompetitor[c] || 0}</b></td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      );
    }

    function LeaderboardPage(){
      return (
        <div className="card">
          <h2>Leaderboard</h2>
          <div className="grid">
            <table>
              <thead>
                <tr>
                  <th>Rank</th>
                  <th>Competitor</th>
                  <th className="right">Total Points</th>
                </tr>
              </thead>
              <tbody>
                {leaderboard.map((r, idx) => (
                  <tr key={r.competitor}>
                    <td>{idx+1}</td>
                    <td><b>{r.competitor}</b></td>
                    <td className="right"><b>{r.totalPoints}</b></td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      );
    }

    function UsagePage(){
      return (
        <div className="card">
          <h2>Usage Heatmap (0/1/2)</h2>
          <div className="muted" style={{marginBottom:10}}>
            Green = 0 used, Amber = 1 used, Red = 2 used (maxed out).
          </div>
          <div className="grid">
            <table>
              <thead>
                <tr>
                  <th className="sticky">Team</th>
                  {competitors.map(c => <th key={c}>{c}</th>)}
                  <th>Total</th>
                </tr>
              </thead>
              <tbody>
                {teams.map(team => {
                  const total = (totalTeamUsage[team] ?? 0);
                  return (
                    <tr key={team}>
                      <td className="sticky">{team}</td>
                      {competitors.map(c => {
                        const v = usageByCompetitorAndTeam?.[c]?.[team] || 0;
                        return (
                          <td key={c} className={heatClass(v)} style={{textAlign:"center", fontWeight:800}}>
                            {v}
                          </td>
                        );
                      })}
                      <td style={{textAlign:"center"}}>{total}</td>
                    </tr>
                  );
                })}
              </tbody>
            </table>
          </div>
        </div>
      );
    }

    function NotFound(){
      return (
        <div className="card">
          <h2>Page not found</h2>
          <div className="muted">Use the tabs above.</div>
        </div>
      );
    }

    let page = null;
    if(route === "/picks") page = <PicksPage />;
    else if(route === "/points") page = <PointsPage />;
    else if(route === "/leaderboard") page = <LeaderboardPage />;
    else if(route === "/usage") page = <UsagePage />;
    else page = <NotFound />;

    return (
      <div className="wrap">
        <TopBar />
        {page}
      </div>
    );
  }

  ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
```

  </body>
</html>